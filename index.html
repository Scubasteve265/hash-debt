<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>HASH DEBT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0a0a0f;
            font-family: 'Share Tech Mono', monospace;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:
                radial-gradient(ellipse at 50% 0%, rgba(15, 100, 80, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 100%, rgba(100, 50, 15, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a0f 0%, #0d0d15 50%, #0a0a0f 100%);
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 500px;
            max-height: 900px;
            display: flex;
            flex-direction: column;
        }

        #topBar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            color: #fff;
            z-index: 10;
        }

        .stat-box {
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 700;
        }

        .stat-value.cash {
            color: #4ade80;
        }

        .stat-value.btc {
            color: #f7931a;
        }

        .stat-value.round {
            color: #8b5cf6;
        }

        #gameCanvas {
            flex: 1;
            width: 100%;
            touch-action: none;
        }

        #sharkBar {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            flex-wrap: wrap;
        }

        .shark-card {
            background: linear-gradient(145deg, #1a1a25, #12121a);
            border: 1px solid #2a2a3a;
            border-radius: 12px;
            padding: 10px 15px;
            text-align: center;
            min-width: 70px;
            transition: all 0.3s ease;
        }

        .shark-card.angry {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .shark-card.warning {
            border-color: #f59e0b;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
        }

        .shark-card.ok {
            border-color: #22c55e;
        }

        .shark-face {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .shark-strikes {
            font-size: 11px;
            color: #888;
        }

        .shark-payment {
            font-size: 12px;
            color: #4ade80;
            font-family: 'Orbitron', monospace;
            margin-top: 4px;
        }

        .add-shark {
            background: linear-gradient(145deg, #1a2a1a, #122012);
            border: 1px dashed #2a4a2a;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .add-shark:hover, .add-shark:active {
            opacity: 1;
            border-color: #4ade80;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(10, 10, 15, 0.95);
            z-index: 100;
            padding: 30px;
            text-align: center;
        }

        #overlay.hidden {
            display: none;
        }

        .overlay-title {
            font-family: 'Orbitron', monospace;
            font-size: 32px;
            font-weight: 900;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(247, 147, 26, 0.5);
        }

        .overlay-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 40px;
            max-width: 280px;
            line-height: 1.6;
        }

        .btn {
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            font-weight: 700;
            padding: 18px 50px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-primary {
            background: linear-gradient(145deg, #f7931a, #d97706);
            color: #000;
            box-shadow: 0 0 30px rgba(247, 147, 26, 0.4);
        }

        .btn-primary:hover, .btn-primary:active {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(247, 147, 26, 0.6);
        }

        .btn-cashout {
            background: linear-gradient(145deg, #22c55e, #16a34a);
            color: #000;
            margin: 10px;
            padding: 15px 30px;
        }

        .btn-continue {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: #fff;
            margin: 10px;
            padding: 15px 30px;
        }

        .multiplier-display {
            font-family: 'Orbitron', monospace;
            font-size: 48px;
            font-weight: 900;
            color: #f7931a;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(247, 147, 26, 0.6);
        }

        .session-earnings {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            color: #4ade80;
            margin-bottom: 30px;
        }

        .btn-row {
            display: flex;
            gap: 15px;
        }

        #messageDisplay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 900;
            color: #fff;
            text-align: center;
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #messageDisplay.show {
            opacity: 1;
        }

        .game-over-stats {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        .game-over-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .game-over-stat:last-child {
            border-bottom: none;
        }

        .game-over-label {
            color: #666;
        }

        .game-over-value {
            font-family: 'Orbitron', monospace;
            color: #fff;
        }

        .shake {
            animation: shake 0.4s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        .payment-modal {
            background: rgba(20, 20, 30, 0.98);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid #2a2a4a;
            max-width: 320px;
            width: 100%;
        }

        .payment-title {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            color: #fff;
            margin-bottom: 20px;
        }

        .payment-shark {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .payment-shark-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .payment-shark-face {
            font-size: 32px;
        }

        .payment-shark-name {
            color: #fff;
            font-size: 14px;
        }

        .payment-shark-wants {
            color: #4ade80;
            font-family: 'Orbitron', monospace;
            font-size: 16px;
        }

        .payment-shark-strikes {
            color: #888;
            font-size: 11px;
        }

        .payment-btns {
            display: flex;
            gap: 8px;
        }

        .btn-pay {
            background: #22c55e;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            cursor: pointer;
        }

        .btn-skip {
            background: #3a3a4a;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            cursor: pointer;
        }

        .btn-skip:hover {
            background: #ef4444;
        }

        .payment-balance {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #2a2a4a;
        }

        .payment-balance-label {
            color: #666;
            font-size: 12px;
        }

        .payment-balance-value {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            color: #4ade80;
        }

        .continue-btn-wrapper {
            margin-top: 20px;
        }

        .round-indicator {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            color: #8b5cf6;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="topBar">
            <div class="stat-box">
                <div class="stat-label">Cash</div>
                <div class="stat-value cash" id="cashDisplay">$0.00</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Mining</div>
                <div class="stat-value btc" id="btcDisplay">0.00000 â‚¿</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Round</div>
                <div class="stat-value round" id="roundDisplay">1</div>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="sharkBar">
            <!-- Sharks will be dynamically added here -->
        </div>

        <div id="messageDisplay"></div>

        <div id="overlay">
            <div class="overlay-title">HASH DEBT</div>
            <div class="overlay-subtitle">
                You're broke. The mafia gave you a mining rig.
                Mine crypto, pay your debts, survive as long as you can.
            </div>
            <button class="btn btn-primary" id="startBtn">START MINING</button>
        </div>
    </div>

    <script>
        // ============================================
        // GAME STATE
        // ============================================
        const GameState = {
            MENU: 'menu',
            PLAYING: 'playing',
            RESULT: 'result',
            CHOICE: 'choice',
            PAYMENT: 'payment',
            GAME_OVER: 'gameOver'
        };

        const SHARK_FACES = ['ðŸ˜ ', 'ðŸ‘Š', 'ðŸ”ª', 'ðŸ’€', 'ðŸ‘¹', 'ðŸ¦ˆ', 'ðŸ˜¤', 'ðŸ¤¬'];
        const SHARK_NAMES = ['Vinnie', 'Marco', 'Big Tony', 'The Butcher', 'Sal', 'Knuckles', 'Rocco', 'The Fixer'];

        let state = GameState.MENU;
        let canvas, ctx;
        let animationId;

        // Player stats
        let cash = 0;
        let sessionBTC = 0;
        let totalStrikes = 0;
        let round = 1;
        let highScore = 0;

        // Mining state
        let angle = 0;
        let targetStart = 0;
        let targetSize = 0.15; // 15% of circle
        let spinSpeed = 0.03;
        let isSpinning = false;
        let multiplier = 1;
        let sessionEarnings = 0;

        // Loan sharks
        let sharks = [];

        // Visual effects
        let particles = [];
        let screenShake = 0;
        let flashColor = null;
        let flashAlpha = 0;
        let ringPulse = 0;
        let lastTime = 0;

        // Sizing
        let centerX, centerY, ringRadius;

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Touch/click handlers
            canvas.addEventListener('touchstart', handleTap, { passive: false });
            canvas.addEventListener('mousedown', handleTap);

            document.getElementById('startBtn').addEventListener('click', startGame);

            // Load high score
            highScore = parseInt(localStorage.getItem('hashDebtHighScore') || '0');

            // Start render loop
            requestAnimationFrame(gameLoop);
        }

        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const topBar = document.getElementById('topBar');
            const sharkBar = document.getElementById('sharkBar');

            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight - topBar.offsetHeight - sharkBar.offsetHeight;

            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            ringRadius = Math.min(canvas.width, canvas.height) * 0.35;
        }

        // ============================================
        // GAME LOOP
        // ============================================
        function gameLoop(timestamp) {
            const deltaTime = (timestamp - lastTime) / 1000;
            lastTime = timestamp;

            update(deltaTime);
            render();

            animationId = requestAnimationFrame(gameLoop);
        }

        function update(dt) {
            // Ring pulse animation
            ringPulse += dt * 2;

            // Update particles
            particles = particles.filter(p => {
                p.x += p.vx * dt;
                p.y += p.vy * dt;
                p.vy += 200 * dt; // gravity
                p.life -= dt;
                return p.life > 0;
            });

            // Screen shake decay
            if (screenShake > 0) {
                screenShake *= 0.9;
                if (screenShake < 0.5) screenShake = 0;
            }

            // Flash decay
            if (flashAlpha > 0) {
                flashAlpha -= dt * 4;
                if (flashAlpha < 0) flashAlpha = 0;
            }

            // Spinning
            if (state === GameState.PLAYING && isSpinning) {
                angle += spinSpeed;
                if (angle > Math.PI * 2) angle -= Math.PI * 2;
            }
        }

        function render() {
            // Clear with background
            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Apply screen shake
            ctx.save();
            if (screenShake > 0) {
                ctx.translate(
                    (Math.random() - 0.5) * screenShake,
                    (Math.random() - 0.5) * screenShake
                );
            }

            // Draw ring glow
            const glowIntensity = 0.3 + Math.sin(ringPulse) * 0.1;
            const gradient = ctx.createRadialGradient(
                centerX, centerY, ringRadius - 30,
                centerX, centerY, ringRadius + 50
            );
            gradient.addColorStop(0, `rgba(74, 222, 128, 0)`);
            gradient.addColorStop(0.5, `rgba(74, 222, 128, ${glowIntensity * 0.15})`);
            gradient.addColorStop(1, `rgba(74, 222, 128, 0)`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw ring
            ctx.beginPath();
            ctx.arc(centerX, centerY, ringRadius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(74, 222, 128, 0.3)';
            ctx.lineWidth = 20;
            ctx.stroke();

            // Draw target zone
            if (state === GameState.PLAYING || state === GameState.RESULT) {
                const targetEnd = targetStart + (Math.PI * 2 * targetSize);

                // Target glow
                ctx.beginPath();
                ctx.arc(centerX, centerY, ringRadius, targetStart, targetEnd);
                ctx.strokeStyle = `rgba(247, 147, 26, ${0.5 + Math.sin(ringPulse * 2) * 0.2})`;
                ctx.lineWidth = 28;
                ctx.stroke();

                // Target main
                ctx.beginPath();
                ctx.arc(centerX, centerY, ringRadius, targetStart, targetEnd);
                ctx.strokeStyle = '#f7931a';
                ctx.lineWidth = 20;
                ctx.stroke();
            }

            // Draw spinning light
            if (state === GameState.PLAYING || state === GameState.RESULT) {
                const lightX = centerX + Math.cos(angle) * ringRadius;
                const lightY = centerY + Math.sin(angle) * ringRadius;

                // Light trail
                for (let i = 1; i <= 8; i++) {
                    const trailAngle = angle - (i * 0.08);
                    const trailX = centerX + Math.cos(trailAngle) * ringRadius;
                    const trailY = centerY + Math.sin(trailAngle) * ringRadius;
                    const alpha = (8 - i) / 8 * 0.5;
                    const size = 12 - i;

                    ctx.beginPath();
                    ctx.arc(trailX, trailY, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                    ctx.fill();
                }

                // Main light
                const lightGradient = ctx.createRadialGradient(lightX, lightY, 0, lightX, lightY, 25);
                lightGradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
                lightGradient.addColorStop(0.5, 'rgba(200, 255, 200, 0.8)');
                lightGradient.addColorStop(1, 'rgba(74, 222, 128, 0)');

                ctx.beginPath();
                ctx.arc(lightX, lightY, 25, 0, Math.PI * 2);
                ctx.fillStyle = lightGradient;
                ctx.fill();

                ctx.beginPath();
                ctx.arc(lightX, lightY, 10, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
            }

            // Draw center info
            if (state === GameState.PLAYING && isSpinning) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.font = '14px "Share Tech Mono"';
                ctx.textAlign = 'center';
                ctx.fillText('TAP TO STOP', centerX, centerY + 5);
            }

            // Draw multiplier in center when active
            if (multiplier > 1 && (state === GameState.PLAYING || state === GameState.CHOICE)) {
                ctx.font = 'bold 48px "Orbitron"';
                ctx.fillStyle = '#f7931a';
                ctx.textAlign = 'center';
                ctx.fillText(`${multiplier.toFixed(1)}x`, centerX, centerY - 10);

                ctx.font = '14px "Share Tech Mono"';
                ctx.fillStyle = 'rgba(247, 147, 26, 0.7)';
                ctx.fillText('MULTIPLIER', centerX, centerY + 20);
            }

            // Draw particles
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * (p.life / p.maxLife), 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${p.color}, ${p.life / p.maxLife})`;
                ctx.fill();
            });

            // Draw flash overlay
            if (flashAlpha > 0) {
                ctx.fillStyle = flashColor.replace(')', `, ${flashAlpha})`).replace('rgb', 'rgba');
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            ctx.restore();
        }

        // ============================================
        // GAME LOGIC
        // ============================================
        function startGame() {
            cash = 50; // Starting cash
            sessionBTC = 0;
            totalStrikes = 0;
            round = 1;
            multiplier = 1;
            sessionEarnings = 0;
            sharks = [];

            // Start with one loan shark
            addShark();

            updateUI();
            hideOverlay();
            startRound();
        }

        function startRound() {
            state = GameState.PLAYING;
            isSpinning = true;
            multiplier = 1;
            sessionEarnings = 0;

            // Randomize target position
            targetStart = Math.random() * Math.PI * 2;

            // Increase difficulty over time
            const difficultyMod = Math.min(round * 0.1, 1.5);
            spinSpeed = 0.03 + (round * 0.002);
            targetSize = Math.max(0.08, 0.15 - (round * 0.005));

            updateUI();
        }

        function handleTap(e) {
            e.preventDefault();

            if (state === GameState.PLAYING && isSpinning) {
                isSpinning = false;
                checkResult();
            }
        }

        function checkResult() {
            const targetEnd = targetStart + (Math.PI * 2 * targetSize);

            // Normalize angles
            let normalizedAngle = angle % (Math.PI * 2);
            let normalizedStart = targetStart % (Math.PI * 2);
            let normalizedEnd = targetEnd % (Math.PI * 2);

            let hit = false;
            if (normalizedEnd > normalizedStart) {
                hit = normalizedAngle >= normalizedStart && normalizedAngle <= normalizedEnd;
            } else {
                // Target wraps around
                hit = normalizedAngle >= normalizedStart || normalizedAngle <= normalizedEnd;
            }

            if (hit) {
                onHit();
            } else {
                onMiss();
            }
        }

        function onHit() {
            state = GameState.RESULT;

            // Calculate earnings (base 0.0001 BTC, affected by multiplier)
            const btcEarned = 0.0001 * multiplier * (1 + Math.random() * 0.5);
            sessionBTC += btcEarned;
            sessionEarnings += btcEarned;

            // Visual feedback
            flashColor = 'rgb(74, 222, 128)';
            flashAlpha = 0.3;
            spawnParticles(centerX + Math.cos(angle) * ringRadius, centerY + Math.sin(angle) * ringRadius, '74, 222, 128', 20);
            showMessage(`+${btcEarned.toFixed(5)} â‚¿`, '#4ade80');

            updateUI();

            // Show choice after delay
            setTimeout(() => {
                showChoiceOverlay();
            }, 800);
        }

        function onMiss() {
            state = GameState.RESULT;
            totalStrikes++;

            // Lose session earnings
            const lost = sessionEarnings;
            sessionEarnings = 0;
            sessionBTC = Math.max(0, sessionBTC - lost);

            // Visual feedback
            flashColor = 'rgb(239, 68, 68)';
            flashAlpha = 0.4;
            screenShake = 20;
            showMessage('MISS!', '#ef4444');

            updateUI();

            if (totalStrikes >= 3) {
                setTimeout(() => gameOver('Too many misses! The rig crashed.'), 1000);
            } else {
                setTimeout(() => {
                    endRound();
                }, 1000);
            }
        }

        function showChoiceOverlay() {
            state = GameState.CHOICE;

            const overlay = document.getElementById('overlay');
            overlay.classList.remove('hidden');
            overlay.innerHTML = `
                <div class="multiplier-display">${multiplier.toFixed(1)}x</div>
                <div class="session-earnings">Session: ${sessionEarnings.toFixed(5)} â‚¿</div>
                <div class="btn-row">
                    <button class="btn btn-cashout" id="cashoutBtn">CASH OUT</button>
                    <button class="btn btn-continue" id="continueBtn">CONTINUE</button>
                </div>
                <div style="margin-top: 20px; color: #666; font-size: 12px;">
                    Continue: ${(multiplier + 0.5).toFixed(1)}x multiplier, but miss = lose it all
                </div>
            `;

            document.getElementById('cashoutBtn').addEventListener('click', () => {
                hideOverlay();
                endRound();
            });

            document.getElementById('continueBtn').addEventListener('click', () => {
                hideOverlay();
                continueRound();
            });
        }

        function continueRound() {
            state = GameState.PLAYING;
            isSpinning = true;
            multiplier += 0.5;

            // Randomize target position
            targetStart = Math.random() * Math.PI * 2;

            // Speed up slightly
            spinSpeed += 0.005;
        }

        function endRound() {
            // Convert BTC to cash (simplified rate)
            const btcPrice = 60000 + Math.random() * 10000; // $60-70k
            const cashEarned = sessionBTC * btcPrice;
            cash += cashEarned;
            sessionBTC = 0;

            showMessage(`+$${cashEarned.toFixed(2)}`, '#4ade80');

            // Go to payment phase
            setTimeout(() => {
                showPaymentPhase();
            }, 1000);
        }

        function showPaymentPhase() {
            state = GameState.PAYMENT;

            // Increase shark demands each round
            sharks.forEach(s => {
                s.demand = Math.floor(s.baseDemand * (1 + (round - 1) * 0.15));
            });

            renderPaymentOverlay();
        }

        function renderPaymentOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.classList.remove('hidden');

            let sharksHtml = sharks.map((s, i) => `
                <div class="payment-shark">
                    <div class="payment-shark-info">
                        <div class="payment-shark-face">${s.face}</div>
                        <div>
                            <div class="payment-shark-name">${s.name}</div>
                            <div class="payment-shark-wants">$${s.demand}</div>
                            <div class="payment-shark-strikes">${s.strikes}/3 strikes</div>
                        </div>
                    </div>
                    <div class="payment-btns">
                        <button class="btn-pay" data-shark="${i}" ${cash < s.demand ? 'disabled style="opacity:0.5"' : ''}>PAY</button>
                        <button class="btn-skip" data-shark="${i}">SKIP</button>
                    </div>
                </div>
            `).join('');

            overlay.innerHTML = `
                <div class="payment-modal">
                    <div class="payment-title">PAYMENT TIME</div>
                    ${sharksHtml}
                    <div class="payment-balance">
                        <div class="payment-balance-label">Your Cash</div>
                        <div class="payment-balance-value">$${cash.toFixed(2)}</div>
                    </div>
                    <div class="continue-btn-wrapper">
                        <button class="btn btn-primary" id="nextRoundBtn" style="padding: 12px 30px; font-size: 14px;">
                            ${sharks.some(s => s.needsAction) ? 'PAY ALL FIRST' : 'NEXT ROUND'}
                        </button>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn" id="newLoanBtn" style="background: linear-gradient(145deg, #2a2a4a, #1a1a3a); color: #8b5cf6; padding: 10px 20px; font-size: 12px;">
                            + NEW LOAN (1.5x earnings)
                        </button>
                    </div>
                </div>
            `;

            // Wire up buttons
            overlay.querySelectorAll('.btn-pay').forEach(btn => {
                btn.addEventListener('click', () => payShark(parseInt(btn.dataset.shark)));
            });

            overlay.querySelectorAll('.btn-skip').forEach(btn => {
                btn.addEventListener('click', () => skipShark(parseInt(btn.dataset.shark)));
            });

            document.getElementById('nextRoundBtn').addEventListener('click', () => {
                if (sharks.every(s => !s.needsAction)) {
                    hideOverlay();
                    round++;
                    startRound();
                }
            });

            document.getElementById('newLoanBtn').addEventListener('click', () => {
                addShark();
                cash += 100; // Loan gives you cash
                renderPaymentOverlay();
                updateSharksUI();
            });
        }

        function payShark(index) {
            const shark = sharks[index];
            if (cash >= shark.demand) {
                cash -= shark.demand;
                shark.needsAction = false;
                shark.mood = 'ok';
                renderPaymentOverlay();
                updateUI();
            }
        }

        function skipShark(index) {
            const shark = sharks[index];
            shark.strikes++;
            shark.needsAction = false;

            if (shark.strikes >= 3) {
                shark.mood = 'angry';
                renderPaymentOverlay();
                setTimeout(() => {
                    gameOver(`${shark.name} lost patience. You're done.`);
                }, 500);
                return;
            }

            shark.mood = shark.strikes >= 2 ? 'angry' : 'warning';
            renderPaymentOverlay();
            updateSharksUI();
        }

        function addShark() {
            const usedNames = sharks.map(s => s.name);
            const availableNames = SHARK_NAMES.filter(n => !usedNames.includes(n));
            const usedFaces = sharks.map(s => s.face);
            const availableFaces = SHARK_FACES.filter(f => !usedFaces.includes(f));

            sharks.push({
                name: availableNames[Math.floor(Math.random() * availableNames.length)] || `Shark ${sharks.length + 1}`,
                face: availableFaces[Math.floor(Math.random() * availableFaces.length)] || 'ðŸ˜ ',
                strikes: 0,
                baseDemand: 30 + sharks.length * 20,
                demand: 30 + sharks.length * 20,
                needsAction: false,
                mood: 'ok'
            });

            updateSharksUI();
        }

        function gameOver(reason) {
            state = GameState.GAME_OVER;

            // Check high score
            const finalScore = round;
            if (finalScore > highScore) {
                highScore = finalScore;
                localStorage.setItem('hashDebtHighScore', highScore.toString());
            }

            const overlay = document.getElementById('overlay');
            overlay.classList.remove('hidden');
            overlay.innerHTML = `
                <div class="overlay-title" style="color: #ef4444;">GAME OVER</div>
                <div class="overlay-subtitle">${reason}</div>
                <div class="game-over-stats">
                    <div class="game-over-stat">
                        <span class="game-over-label">Rounds Survived</span>
                        <span class="game-over-value">${round}</span>
                    </div>
                    <div class="game-over-stat">
                        <span class="game-over-label">Peak Cash</span>
                        <span class="game-over-value">$${cash.toFixed(2)}</span>
                    </div>
                    <div class="game-over-stat">
                        <span class="game-over-label">Sharks Juggled</span>
                        <span class="game-over-value">${sharks.length}</span>
                    </div>
                    <div class="game-over-stat">
                        <span class="game-over-label">High Score</span>
                        <span class="game-over-value">${highScore} rounds</span>
                    </div>
                </div>
                <button class="btn btn-primary" id="restartBtn">TRY AGAIN</button>
            `;

            document.getElementById('restartBtn').addEventListener('click', startGame);
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function updateUI() {
            document.getElementById('cashDisplay').textContent = `$${cash.toFixed(2)}`;
            document.getElementById('btcDisplay').textContent = `${sessionBTC.toFixed(5)} â‚¿`;
            document.getElementById('roundDisplay').textContent = round;
            updateSharksUI();
        }

        function updateSharksUI() {
            const bar = document.getElementById('sharkBar');
            bar.innerHTML = sharks.map(s => `
                <div class="shark-card ${s.mood}">
                    <div class="shark-face">${s.face}</div>
                    <div class="shark-strikes">${s.strikes}/3</div>
                    <div class="shark-payment">$${s.demand}</div>
                </div>
            `).join('');
        }

        function showMessage(text, color) {
            const msg = document.getElementById('messageDisplay');
            msg.textContent = text;
            msg.style.color = color;
            msg.classList.add('show');

            setTimeout(() => {
                msg.classList.remove('show');
            }, 800);
        }

        function hideOverlay() {
            document.getElementById('overlay').classList.add('hidden');
        }

        function spawnParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 400,
                    vy: (Math.random() - 0.5) * 400 - 100,
                    size: 3 + Math.random() * 5,
                    color: color,
                    life: 0.5 + Math.random() * 0.5,
                    maxLife: 1
                });
            }
        }

        // ============================================
        // START
        // ============================================
        window.addEventListener('load', init);
    </script>
</body>
</html>
